<script>
    try {
        // Obtener el parámetro "data" de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const jsonData = urlParams.get("data");
        if (!jsonData) throw new Error("No se encontró el parámetro 'data'.");

        // Parsear el JSON recibido
        const parsedData = JSON.parse(decodeURIComponent(jsonData));

        // Construir el CSV
        const header = parsedData.header.join(",");
        const rows = parsedData.data.map(row => row.join(",")).join("\n");
        const csvContent = `${header}\n${rows}`;

        // Descargar el archivo CSV
        const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "archivo_generado.csv";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    } catch (error) {
        console.error("Error al procesar el JSON:", error);
        alert("Hubo un error al procesar los datos.");
    }
</script>
