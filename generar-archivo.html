<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generar Archivo Excel</title>
    <!-- Agregar la biblioteca SheetJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <script>
        // Obtener el contenido de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const data = urlParams.get("data") || "Columna1,Columna2,Columna3\nDato1,Dato2,Dato3";

        // Decodificar el contenido
        const decodedData = decodeURIComponent(data);

        // Procesar los datos y convertirlos en un array para Excel
        const rows = decodedData.split("\n").map(row => row.split(","));

        // Crear un libro de Excel y una hoja de trabajo
        const workbook = XLSX.utils.book_new();
        const worksheet = XLSX.utils.aoa_to_sheet(rows);

        // Agregar la hoja al libro
        XLSX.utils.book_append_sheet(workbook, worksheet, "Hoja1");

        // Generar el archivo Excel
        const excelBlob = XLSX.write(workbook, { bookType: "xlsx", type: "blob" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(excelBlob);
        link.download = "archivo_generado.xlsx"; // Cambia el nombre según sea necesario
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        // Cerrar la pestaña después de un breve retraso
        setTimeout(() => {
            window.close();
        }, 1000); // Espera 1 segundo para asegurar la descarga antes de cerrar
    </script>
    <p>Generando archivo... Si la descarga no inicia, revisa la configuración del navegador.</p>
</body>
</html>
